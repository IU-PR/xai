<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Integrated Gradients Method for Image Classification # XAI Course Project | Anatoliy Pushkarev
Goal # Develop a robust image classification model and analyze its behavior with the help of the integrated gradients method.
Integrated gradients paper
Integrated Gradients # Integrated Gradients is a technique for attributing a classification model&rsquo;s prediction to its input features. It is a model interpretability technique: you can use it to visualize the relationship between input features and model predictions."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Integrated Gradients Method for Image Classification # XAI Course Project | Anatoliy Pushkarev
Goal # Develop a robust image classification model and analyze its behavior with the help of the integrated gradients method.
Integrated gradients paper
Integrated Gradients # Integrated Gradients is a technique for attributing a classification model&rsquo;s prediction to its input features. It is a model interpretability technique: you can use it to visualize the relationship between input features and model predictions."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/docs/groups/integrated-gradients/"><meta property="article:section" content="docs"><title>Integrated Gradients | XAI</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.e832d4e94212199857473bcf13a450d089c3fcd54ccadedcfac84ed0feff83fb.css integrity="sha256-6DLU6UISGZhXRzvPE6RQ0InD/NVMyt7c+shO0P7/g/s=" crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/mathtex-script-type.min.js integrity=sha384-jiBVvJ8NGGj5n7kJaiWwWp9AjC+Yh8rhZY3GtAX8yU28azcLgoRo4oukO87g7zDT crossorigin=anonymous></script><script defer src=/flexsearch.min.js></script><script defer src=/en.search.min.a040731689cd19718a91f9c6750d976d00425e6cc042ec907df8749f70d883ee.js integrity="sha256-oEBzFonNGXGKkfnGdQ2XbQBCXmzAQuyQffh0n3DYg+4=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/YELLOW_BAR.png alt=Logo><span><b>XAI</b></span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/groups/cam_and_secam/>CAM and SeCAM</a></li><li><a href=/docs/groups/diffusion-lens-interpreting-text-encoders-in-text-to-image-pipelines-tuned-using-dreambooth/>Diffusion Lens: Interpreting Text Encoders in Text-to-Image pipelines</a></li><li><a href=/docs/groups/dimensionality-reduction-in-nlp-visualizing-sentence-embeddings-with-umap-and-t-sne/>Dimensionality Reduction in NLP: Visualizing Sentence Embeddings with UMAP and t-SNE</a></li><li><a href=/docs/groups/example/>Example</a></li><li><a href=/docs/groups/ai-playing-geoguessr-explained/>Ai Playing Geo Guessr Explained</a></li><li><a href=/docs/groups/contrastive-grad-cam-consistency/>Contrastive Grad Cam Consistency</a></li><li><a href=/docs/groups/dndfs_shap/>Dndfs Shap</a></li><li><a href=/docs/groups/gradcam/>Grad Cam</a></li><li><a href=/docs/groups/integrated-gradients/ class=active>Integrated Gradients</a></li><li><a href=/docs/groups/integrated_hessians/>Integrated Hessians</a></li><li><a href=/docs/groups/kernel-shap/>Kernel Shap</a></li><li><a href=/docs/groups/rag/>Rag</a></li><li><a href=/docs/groups/shap_darya_and_viktoria/>Shap Darya and Viktoria</a></li><li><a href=/docs/groups/sverl_tac_toe/>Sverl Tac Toe</a></li><li><a href=/docs/groups/torchprism/>Torch Prism</a></li><li><a href=/docs/groups/xai_for_transformers/>Xai for Transformers</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Integrated Gradients</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#integrated-gradients-method-for-image-classification>Integrated Gradients Method for Image Classification</a><ul><li><a href=#goal>Goal</a></li><li><a href=#integrated-gradients>Integrated Gradients</a><ul><li><a href=#steps>Steps</a></li></ul></li><li><a href=#mnist-fashion-dataset>MNIST Fashion Dataset</a></li><li><a href=#model>Model</a></li><li><a href=#training>Training</a></li><li><a href=#results-of-training>Results of Training</a></li><li><a href=#applying-integrated-gradients>Applying Integrated Gradients</a></li><li><a href=#more-examples>More Examples</a></li><li><a href=#challenges>Challenges</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=integrated-gradients-method-for-image-classification>Integrated Gradients Method for Image Classification
<a class=anchor href=#integrated-gradients-method-for-image-classification>#</a></h1><p><strong>XAI Course Project | Anatoliy Pushkarev</strong></p><h2 id=goal>Goal
<a class=anchor href=#goal>#</a></h2><p>Develop a robust image classification model and analyze its behavior with the help of the integrated gradients method.</p><p><a href=https://arxiv.org/abs/1703.01365>Integrated gradients paper</a></p><h2 id=integrated-gradients>Integrated Gradients
<a class=anchor href=#integrated-gradients>#</a></h2><p>Integrated Gradients is a technique for attributing a classification model&rsquo;s prediction to its input features. It is a model interpretability technique: you can use it to visualize the relationship between input features and model predictions. It finds the importance of each pixel or feature in input data for a particular prediction of the model.</p><p>Integrated gradients original paper can be found
<a href=https://arxiv.org/abs/1703.01365>here</a>.</p><h3 id=steps>Steps
<a class=anchor href=#steps>#</a></h3><ol><li>Select baseline (uniform distribution for all classes).</li><li>Evaluate the path from baseline to input data point by many iterations.</li><li>Observe how changing input data affects gradients.</li><li>Integrate all gradients.</li></ol><p>This is the original integrated gradients formula:
<img src="https://www.dropbox.com/scl/fi/iheoqe68yvb4rgk99rqd3/2024-05-24-09.39.57.png?rlkey=78wwqc9xwk5zt7l101kejxzj3&amp;st=vf2foy7b&amp;dl=1" alt="Original Integrated Gradients formula"></p><p>This is the Riemann approximation of the original formula, which is always used.
<img src="https://www.dropbox.com/scl/fi/iheoqe68yvb4rgk99rqd3/2024-05-24-09.39.57.png?rlkey=78wwqc9xwk5zt7l101kejxzj3&amp;st=vf2foy7b&amp;dl=1" alt="Approximation of the Original Integrated Gradients formula"></p><p>A very good article about integrated gradients and Riemann Approximation can be found here:</p><ul><li><a href=https://distill.pub/2020/attribution-baselines/>Great IG method explanation</a></li></ul><p>This is a good picture which shows, why exactly we need to sum gradients. Basically if we just take the gradients of the model wrt the inputs, we will get a lot of noise, which is illustrated on the right side of the picture. But if we scale the inputs, at the some point we get interesting gradients, which the method uses.</p><p><img src="https://www.dropbox.com/scl/fi/wnkhibb5476z0g6bwg64h/2024-05-24-09.40.41.png?rlkey=ma6pk54gtgzpoiso6980nhfma&amp;st=kj4ldpuu&amp;dl=1" alt="How IG method works, why scale"></p><h2 id=mnist-fashion-dataset>MNIST Fashion Dataset
<a class=anchor href=#mnist-fashion-dataset>#</a></h2><p>The dataset which I am using for the test purposes is Fashion-MNIST. Fashion-MNIST is a dataset of Zalando&rsquo;s article imagesâ€”consisting of a training set of 60,000 examples and a test set of 10,000 examples. Each example is a 28x28 grayscale image, associated with a label from 10 classes. Zalando intends Fashion-MNIST to serve as a direct drop-in replacement for the original MNIST dataset for benchmarking machine learning algorithms. It shares the same image size and structure of training and testing splits.</p><p><img src="https://www.dropbox.com/scl/fi/qggb41s30tq8829uul714/2024-05-24-09.40.31.png?rlkey=2as21m78o53kw5ofyrqn3c55l&amp;st=24vyd52t&amp;dl=1" alt="Fashion-MNIST dataset"></p><h2 id=model>Model
<a class=anchor href=#model>#</a></h2><ul><li>Keras Sequential</li><li>3 Conv layers</li><li>2 Max pooling layers</li><li>Dropouts</li><li>2 FC layers</li></ul><p><img src="https://www.dropbox.com/scl/fi/l2avsyvx284nwywxhk1s7/2024-05-24-09.40.59.png?rlkey=edolnwdfjmmvfi9sickakvict&amp;st=oyk9q2x6&amp;dl=1" alt="Model architecture"></p><h2 id=training>Training
<a class=anchor href=#training>#</a></h2><p>Below you can find a screenshot of model training loop. It is pretty straightforward.</p><p><img src="https://www.dropbox.com/scl/fi/c4j3ifjeqv9wla7lznxdx/2024-05-24-09.41.06.png?rlkey=2e8ztnbwne6qlhrv05a5006qr&amp;st=xjsppae0&amp;dl=1" alt="Model training loop"></p><h2 id=results-of-training>Results of Training
<a class=anchor href=#results-of-training>#</a></h2><p>As a result, I got a robust model with accuracy > 90%, which is good for explanation.</p><p><img src="https://www.dropbox.com/scl/fi/7ea8iwotib8junpad2lsw/2024-05-24-09.41.28.png?rlkey=ienzj5e7khphc6wvzrjrv83c6&amp;st=go9ppgo5&amp;dl=1" alt="Results of training"></p><p>There are some classes with lower precision and recall, it will be interesting to check IGs of them (for example, Shirt classs).</p><p>Examples of correctly predicted classes:
<img src="https://www.dropbox.com/scl/fi/ajf8itfsaal7xgq88hkf5/2024-05-24-09.41.37.png?rlkey=fhnh2pd2wdtd9fvwguzq7bv52&amp;st=t9q53mwl&amp;dl=1" alt="Correctly predicted classes"></p><p>Examples of incorrectly predicted classes:
<img src="https://www.dropbox.com/scl/fi/w955alns3l48o1h4rut76/2024-05-24-09.41.41.png?rlkey=3vpw3qqvspf19etkt9pm23lpa&amp;st=c2l30vrq&amp;dl=1" alt="Incorrectly predicted classes"></p><h2 id=applying-integrated-gradients>Applying Integrated Gradients
<a class=anchor href=#applying-integrated-gradients>#</a></h2><p>Below you can find maps for IGs, which I`ve got after the method execution. Basically, red means that these points are important for certain class and blue means that these are negative features for a particular class.</p><p><img src="https://www.dropbox.com/scl/fi/wc8nue1m329g52wr4bevq/2024-05-24-09.41.51.png?rlkey=s1gvne2bhti1wqwph7p8vytyt&amp;st=03xiuqcy&amp;dl=1" alt="IG examples"></p><p><img src="https://www.dropbox.com/scl/fi/f8ean846q9796nhhn3vsb/2024-05-24-09.41.58.png?rlkey=e7rxs252ieqceivfkvot2tn57&amp;st=oyjldqbh&amp;dl=1" alt="IG examples"></p><h2 id=more-examples>More Examples
<a class=anchor href=#more-examples>#</a></h2><p>This is and example of how IGs work with regression tasks. Basically x-axis is features and y-axis is weights of the feature to the output.</p><p><img src="https://www.dropbox.com/scl/fi/mumi06hake9n64say48iv/2024-05-24-09.42.05.png?rlkey=z4fjb6hkm1nacmwvp3qgjgb4l&amp;st=dhk31a8a&amp;dl=1" alt="IG examples"></p><h2 id=challenges>Challenges
<a class=anchor href=#challenges>#</a></h2><ul><li>Lack of open-source stable solutions for any model.</li><li>Most likely you have to implement your own solution for a complicated model.</li><li>Lack of support and community â€“ not so popular (SHAP and GradCAM paper cited 20K times, IG â€“ 5K times).</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/IU-PR/Capstone_project/tree/master//content/docs/Groups/Integrated%20Gradients.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#integrated-gradients-method-for-image-classification>Integrated Gradients Method for Image Classification</a><ul><li><a href=#goal>Goal</a></li><li><a href=#integrated-gradients>Integrated Gradients</a><ul><li><a href=#steps>Steps</a></li></ul></li><li><a href=#mnist-fashion-dataset>MNIST Fashion Dataset</a></li><li><a href=#model>Model</a></li><li><a href=#training>Training</a></li><li><a href=#results-of-training>Results of Training</a></li><li><a href=#applying-integrated-gradients>Applying Integrated Gradients</a></li><li><a href=#more-examples>More Examples</a></li><li><a href=#challenges>Challenges</a></li></ul></li></ul></nav></div></aside></main></body></html>